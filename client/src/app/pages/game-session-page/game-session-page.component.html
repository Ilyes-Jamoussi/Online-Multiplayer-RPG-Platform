<app-ui-page-layout [hasHeader]="true" [hasFooter]="false" [showBackButton]="true" headerTitle="Session de Jeu" (backClick)="onLeaveGame()">
    <app-game-timer></app-game-timer>

    <div class="game-session-content">
        @if (gameId) {
        <app-game-map [gameId]="gameId"></app-game-map>
        } @else {
        <div class="error">
            <p>Aucune carte de jeu disponible</p>
            <p>Retourne à la salle d'attente et redémarre le jeu</p>
        </div>
        }
    </div>

    @if (gameId) {
    <app-players-list></app-players-list>
    <app-player-info></app-player-info>
    <app-game-info [mapSize]="mapSize" [activePlayer]="activePlayer"> </app-game-info>
    }

    <div class="game-controls">
        <button [disabled]="!isMyTurn || !isGameStarted" (click)="onEndTurn()">Terminer le tour</button>
        <button [disabled]="isActionDisabled()" (click)="onAction()">Action</button>
        <button class="abandon-button" (click)="onLeaveGame()">Abandonner la partie</button>
        @if(!isGameStarted && isMyTurn) {
        <button (click)="onStartGame()">Démarrer le jeu</button>
        }

        <!-- Debug info (à supprimer en production quand DebugPanel sera implémenté) -->
        <div class="debug-info">
            <p>Taille de carte: {{ mapSizeValue }}</p>
            <p>Mode: {{ mode }}</p>
            <p>Numéro de tour: {{ turnNumber }}</p>
            <p>Jeu démarré: {{ isGameStarted }}</p>
            <p>Mon tour: {{ isMyTurn }}</p>
            <p>Temps restant: {{ timeRemaining }}</p>
            <p>Session ID: {{ inGameService.inGameSession().id }}</p>
            <p>Active Player ID: {{ inGameService.inGameSession().currentTurn.activePlayerId }}</p>
            <p>Joueurs en jeu: {{ getInGamePlayersCount() }}</p>
            <p>Points de mouvement: {{ getCurrentPlayerMovementPoints() }}</p>
            <p>Tuiles atteignables: {{ getReachableTilesCount() }}</p>
            <p>Debug: {{ getDebugInfo() }}</p>
        </div>
    </div>
</app-ui-page-layout>

@if (isTransitioning) {
<div class="transition-overlay" (click)="$event.stopPropagation()">
    <div class="transition-modal">
        <h2>{{ transitionMessage }}</h2>
        <div class="loading-spinner">
            <p>{{ timeRemaining }}</p>
        </div>
    </div>
</div>
}

<!-- Combat Overlay -->
<app-combat-overlay></app-combat-overlay>
