<app-ui-page-layout [hasHeader]="true" [hasFooter]="false" [showBackButton]="true" headerTitle="Session de Jeu" (backClick)="onBack()">
    <app-game-timer></app-game-timer>
    
    <div class="game-session-content">
        @if (gameId()) {
            <app-game-map [gameId]="gameId()"></app-game-map>
        } @else {
            <div class="error">
                <p>Aucune carte de jeu disponible</p>
                <p>Retourne à la salle d'attente et redémarre le jeu</p>
            </div>
        }
    </div>
    
    @if (gameId()) {
        <app-players-list></app-players-list>
        <app-player-info></app-player-info>
        <app-game-info 
            [mapSize]="mapSize" 
            [activePlayer]="activePlayer">
        </app-game-info>
    }

    <!-- Game controls -->
    <div class="game-controls">
        <button [disabled]="!inGameService.isMyTurn() || !inGameService.isGameStarted()" (click)="onEndTurn()">Terminer le tour</button>
        <button class="abandon-button" (click)="onAbandonGame()">Abandonner la partie</button>
        
        <!-- Debug info (à supprimer en production) -->
        <div class="debug-info">
            <p>Taille de carte: {{ inGameService.mapSize() }}</p>
            <p>Mode: {{ inGameService.mode() }}</p>
            <p>Numéro de tour: {{ inGameService.turnNumber() }}</p>
            <p>Jeu démarré: {{ inGameService.isGameStarted() }}</p>
            <p>Mon tour: {{ inGameService.isMyTurn() }}</p>
            <p>Temps restant: {{ inGameService.timeRemaining() }}</p>
        </div>
    </div>
</app-ui-page-layout>

@if (inGameService.isTransitioning()) {
<div class="transition-overlay" (click)="$event.stopPropagation()">
    <div class="transition-modal">
        <h2>{{ transitionMessage }}</h2>
        <div class="loading-spinner">
            <p>{{ inGameService.timeRemaining() }}</p>
        </div>
    </div>
</div>
}

@if (adminModeService.isAdminModeActivated()) {
  <div class="admin-badge" aria-live="polite" title="Mode admin activé">
    Mode Admin activé
  </div>
}
