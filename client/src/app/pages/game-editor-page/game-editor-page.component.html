<app-ui-page-layout
    [hasHeader]="true"
    headerTitle="Éditeur de Jeu"
    headerSubtitle="Créez et modifiez votre carte de jeu"
    [showBackButton]="true"
    [hasFooter]="true"
    (backClick)="goBack()"
>
    <div class="editor-container">
        <!-- Editor Content -->
        <div class="editor-content">
            <app-draggable-panel title="Outils" storageKey="editor.toolbar.pos" [snap]="10">
                <app-editor-toolbar></app-editor-toolbar>
            </app-draggable-panel>
            <app-draggable-panel title="Inventaire" storageKey="editor.inventory.pos" [snap]="10">
                <app-editor-inventory></app-editor-inventory>
            </app-draggable-panel>
            <div class="grid-container">
                @if(store.tiles().length > 0) {
                <div #gridWrapper class="grid-wrapper">
                    <div
                        class="grid"
                        [ngStyle]="{
                            'grid-template-columns': 'repeat(' + store.size() + ', minmax(0,1fr))',
                            'grid-template-rows': 'repeat(' + store.size() + ', minmax(0,1fr))'
                        }"
                    >
                        @for(tile of store.tiles(); track $index; let i = $index) {
                        <app-editor-tile [tile]="tile" appTileSizeProbe [probeActive]="i === 0" (sizeChange)="onResize($event)"></app-editor-tile>
                        }
                    </div>
                    <div
                        class="objects-overlay"
                        [ngStyle]="{
                            'grid-template-columns': 'repeat(' + store.size() + ', minmax(0,1fr))',
                            'grid-template-rows': 'repeat(' + store.size() + ', minmax(0,1fr))'
                        }"
                    >
                        @for (obj of store.placedObjects(); track obj.id) {
                        <app-editor-placed-object [object]="obj" [tileSize]="store.tileSizePx" />
                        }
                    </div>
                </div>
                }
            </div>
        </div>
    </div>
    <div slot="footer">
        <app-ui-input type="name" placeholder="Saisissez le nom de votre jeu" [value]="store.name" (valueChange)="store.setName($event)"></app-ui-input>
        <app-ui-input type="description" placeholder="Décrivez votre jeu en quelques mots" [value]="store.description" (valueChange)="store.setDescription($event)"></app-ui-input>
        <app-ui-button (buttonClick)="onReset()">Réinitialiser la grille</app-ui-button>
        <app-ui-button (buttonClick)="onSave()" [disabled]="!editorCheck.canSave()">Sauvegarder</app-ui-button>
        <app-editor-errors-badge></app-editor-errors-badge>
    </div>
</app-ui-page-layout>
