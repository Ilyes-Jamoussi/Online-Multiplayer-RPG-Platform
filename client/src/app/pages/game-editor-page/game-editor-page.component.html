<app-ui-page-layout
    [hasHeader]="true"
    headerTitle="Éditeur de Jeu"
    headerSubtitle="Créez et modifiez votre carte de jeu"
    [showBackButton]="true"
    [hasFooter]="true"
    (backClick)="goBack()"
>
    <div class="editor-container">
        <div class="editor-content">
            <app-draggable-panel title="Outils" storageKey="editor.toolbar.pos" [snap]="10">
                <app-editor-toolbar></app-editor-toolbar>
            </app-draggable-panel>
            <app-draggable-panel title="Inventaire" storageKey="editor.inventory.pos" [snap]="10">
                <app-editor-inventory></app-editor-inventory>
            </app-draggable-panel>
            <div class="grid-container">
                @if(gameEditorStoreService.tiles().length > 0) {
                <div #gridWrapper class="grid-wrapper">
                    <div
                        class="grid"
                        [ngStyle]="{
                            'grid-template-columns': 'repeat(' + gameEditorStoreService.size() + ', minmax(0,1fr))',
                            'grid-template-rows': 'repeat(' + gameEditorStoreService.size() + ', minmax(0,1fr))'
                        }"
                    >
                        @for(tile of gameEditorStoreService.tiles(); track $index; let i = $index) {
                        <app-editor-tile [tile]="tile" appTileSizeProbe [probeActive]="i === 0" (sizeChange)="onResize($event)"></app-editor-tile>
                        }
                    </div>
                    <div
                        class="objects-overlay"
                        [class.disable-pointer-events]="disableOverlayPointerEvents"
                        [ngStyle]="{
                            'grid-template-columns': 'repeat(' + gameEditorStoreService.size() + ', minmax(0,1fr))',
                            'grid-template-rows': 'repeat(' + gameEditorStoreService.size() + ', minmax(0,1fr))'
                        }"
                    >
                        @for (obj of gameEditorStoreService.placedObjects; track obj.id) {
                        <app-editor-placed-object [object]="obj" [tileSize]="gameEditorStoreService.tileSizePx" />
                        }
                    </div>
                </div>
                }
            </div>
        </div>
    </div>
    <div slot="footer">
        <app-ui-input
            type="text"
            placeholder="Saisissez le nom de votre jeu"
            [value]="gameEditorStoreService.name"
            (valueChange)="gameEditorStoreService.name = $event"
            [maxLength]="gameNameMaxLength"
        ></app-ui-input>
        <app-ui-input
            type="text"
            placeholder="Décrivez votre jeu en quelques mots"
            [value]="gameEditorStoreService.description"
            (valueChange)="gameEditorStoreService.description = $event"
            [maxLength]="descriptionMaxLength"
        ></app-ui-input>
        <app-ui-button (buttonClick)="onReset()">Réinitialiser la grille</app-ui-button>
        <app-ui-button (buttonClick)="onSave()" [disabled]="!gameEditorCheckService.canSave()">Sauvegarder</app-ui-button>
        <app-errors-badge validationType="game-editor"></app-errors-badge>
    </div>
</app-ui-page-layout>
