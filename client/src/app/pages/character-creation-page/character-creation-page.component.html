<app-ui-page-layout [hasHeader]="true" [hasFooter]="true" headerTitle="Cr√©ation de personnage" [showBackButton]="true">
  <div class="layout">
    <section class="card" aria-label="S√©lection d'avatar">
      <div class="card-body">
        <div class="selected">
          @if (character.avatar === null) {
            <div class="selected-empty">üë§</div>
          } @else {
            <img class="selected-img" [src]="getSelectedAvatarImage()" [alt]="'Avatar ' + (character.avatar + 1)" />
          }
        </div>

        <div class="grid" role="grid" aria-label="Avatars">
          @for (a of avatars; track a) {
            <button
              type="button"
              class="cell"
              [class.active]="character.avatar === a"
              (click)="selectAvatar(a)"
              role="gridcell"
              [attr.aria-label]="'Avatar ' + (a + 1)"
              [attr.aria-pressed]="character.avatar === a"
            >
              <img class="cell-img" [src]="getAvatarImage(a)" [alt]="'Avatar ' + (a + 1)" />
              <span class="cell-num">{{ a + 1 }}</span>
            </button>
          }
        </div>
      </div>
    </section>

    <section class="card" aria-label="Param√®tres du personnage">
      <div class="card-body">
        <div class="field">
          <h3>Nom *</h3>
          <app-ui-input
            type="text"
            placeholder="Nom du h√©ros"
            [value]="character.name"
            (valueChange)="onNameChange($event)"
            [maxLength]="characterNameMaxLength"
          ></app-ui-input>
        </div>

        <div class="field">
          <h3>Vie</h3>
          <app-stats-bar label="Vie" [value]="character.attributes.life" [maxValue]="6" color="#e74c3c"></app-stats-bar>
        </div>

        <div class="field">
          <h3>Vitesse</h3>
          <app-stats-bar label="Rapidit√©" [value]="character.attributes.speed" [maxValue]="6" color="#2ecc71"></app-stats-bar>
        </div>

        <div class="field">
          <h3>Bonus (+2)</h3>
          <div class="radio-row" role="radiogroup">
            <label class="radio" [class.on]="character.bonus === 'life'">
              <input type="radio" name="bonus" value="life" [checked]="character.bonus === 'life'" (change)="onBonusChange('life')" />
              <span>‚ù§Ô∏è Vie</span>
            </label>
            <label class="radio" [class.on]="character.bonus === 'speed'">
              <input type="radio" name="bonus" value="speed" [checked]="character.bonus === 'speed'" (change)="onBonusChange('speed')" />
              <span>‚ö° Rapidit√©</span>
            </label>
          </div>
        </div>

        <div class="field">
          <h3>Choix des d√©s</h3>
          <p class="sub">Assignez un seul D6 (l'autre sera D4 automatiquement)</p>

          <div class="dice-rows">
            <div class="dice-card">
              <span>Attaque</span>
              <div class="dice-row">
                <button type="button" class="dice-btn" [class.sel]="character.diceAssignment.attack === 'D4'" (click)="onAttackDiceChange('D4')">
                  <img [src]="assetsService.getDiceImage('D4')" alt="D4" />
                </button>
                <button type="button" class="dice-btn" [class.sel]="character.diceAssignment.attack === 'D6'" (click)="onAttackDiceChange('D6')">
                  <img [src]="assetsService.getDiceImage('D6')" alt="D6" />
                </button>
              </div>
            </div>

            <div class="dice-card">
              <span>D√©fense</span>
              <div class="dice-row">
                <button type="button" class="dice-btn" [class.sel]="character.diceAssignment.defense === 'D4'" (click)="onDefenseDiceChange('D4')">
                  <img [src]="assetsService.getDiceImage('D4')" alt="D4" />
                </button>
                <button type="button" class="dice-btn" [class.sel]="character.diceAssignment.defense === 'D6'" (click)="onDefenseDiceChange('D6')">
                  <img [src]="assetsService.getDiceImage('D6')" alt="D6" />
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div slot="footer" class="actions">
    <app-ui-button (buttonClick)="generateRandomCharacter()">üé≤ G√©n√©rer al√©atoire</app-ui-button>
    <app-ui-button (buttonClick)="onSubmit()" [disabled]="!characterCreationCheckService.canCreate()">Cr√©er le personnage ‚Üí</app-ui-button>
    <app-errors-badge validationType="character-creation"></app-errors-badge>
  </div>
</app-ui-page-layout>
