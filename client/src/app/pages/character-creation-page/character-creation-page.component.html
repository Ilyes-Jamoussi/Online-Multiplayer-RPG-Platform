<app-ui-page-layout [hasHeader]="true" [hasFooter]="true" headerTitle="Cr√©ation de personnage" [showBackButton]="true" (backClick)="onBackClick()">
    <div class="selection-layout">
        <!-- Panneau de s√©lection d'avatar -->
        <section class="character-grid-panel" aria-label="S√©lection d'avatar">
            <div class="avatar-card">
                <div class="selected-avatar-display">
                    <div class="selected-avatar-frame">
                        @if (character.avatar === null) {
                            <div class="no-selection">
                                <div class="selection-icon">üë§</div>
                                <h4>S√©lectionner un avatar</h4>
                            </div>
                        } @else {
                            <img
                                [src]="getSelectedAvatarImage()"
                                [alt]="'Avatar s√©lectionn√© ' + (character.avatar + 1)"
                                class="selected-avatar-gif"
                            />
                        }
                    </div>
                </div>

                <div class="character-grid" role="grid" aria-label="Grille des avatars disponibles">
                    @for (avatar of avatars; track avatar) {
                        <button
                            type="button"
                            class="character-slot"
                            [class.selected]="character.avatar === avatar"
                            (click)="selectAvatar(avatar)"
                            [attr.aria-label]="'Avatar ' + (avatar + 1)"
                            [attr.aria-pressed]="character.avatar === avatar"
                            role="gridcell"
                        >
                            <div class="character-portrait">
                                <img [src]="getAvatarImage(avatar)" [alt]="'Avatar ' + (avatar + 1)" class="avatar-gif" />
                                <span class="avatar-number">{{ avatar + 1 }}</span>
                            </div>
                        </button>
                    }
                </div>
            </div>
        </section>

        <!-- Panneau de configuration du personnage -->
        <section class="character-info-panel" aria-label="Configuration du personnage">
            <div class="info-card">
                <div class="character-name-section">
                    <h3>Nom *</h3>
                    <app-ui-input
                        type="name"
                        placeholder="Nom du h√©ros"
                        [value]="character.name"
                        (valueChange)="onNameChange($event)"
                        [maxLength]="characterNameMaxLength"
                        [allowedCharsPattern]="nameAllowedCharsPattern"
                        [errorMessage]="getNameErrorMessage()"
                    ></app-ui-input>
                </div>

                <div class="stats-section">
                    <h3>Attributs</h3>
                    <p class="attributes-help">Tous les attributs commencent √† 4. Ajoutez un bonus de +2 √† Vie ou Rapidit√©.</p>

                    <div class="stats-grid">
                        <div class="stats-bars">
                            <div class="stat-item">
                                <app-stats-bar label="Vie" [value]="character.attributes.life" [maxValue]="6" color="#e74c3c"></app-stats-bar>
                                <div class="attribute-description">Points de vie du personnage</div>
                            </div>

                            <div class="stat-item">
                                <app-stats-bar label="Rapidit√©" [value]="character.attributes.speed" [maxValue]="6" color="#2ecc71"></app-stats-bar>
                                <div class="attribute-description">Vitesse de d√©placement</div>
                            </div>
                        </div>

                        <div class="bonus-selection">
                            <h4>Bonus (+2)</h4>
                            <div class="bonus-options" role="radiogroup" aria-label="S√©lection du bonus d'attribut">
                                <label class="bonus-option" [class.selected]="character.bonus === 'life'">
                                    <input
                                        type="radio"
                                        name="bonus"
                                        value="life"
                                        [checked]="character.bonus === 'life'"
                                        (change)="onBonusChange('life')"
                                        aria-label="Bonus de vie"
                                    />
                                    <span>‚ù§Ô∏è Vie</span>
                                </label>

                                <label class="bonus-option" [class.selected]="character.bonus === 'speed'">
                                    <input
                                        type="radio"
                                        name="bonus"
                                        value="speed"
                                        [checked]="character.bonus === 'speed'"
                                        (change)="onBonusChange('speed')"
                                        aria-label="Bonus de rapidit√©"
                                    />
                                    <span>‚ö° Rapidit√©</span>
                                </label>
                            </div>
                        </div>

                        <div class="dice-selection">
                            <h4>Choix des d√©s</h4>
                            <p class="dice-help">Assignez un seul D6 (l'autre sera D4 automatiquement)</p>

                            <div class="dice-cards">
                                <div class="dice-card">
                                    <label>Attaque</label>
                                    <div class="attribute-description">Force d'attaque au combat</div>
                                    <div class="dice-buttons" role="radiogroup" aria-label="D√© d'attaque">
                                        <button
                                            type="button"
                                            class="dice-btn"
                                            [class.selected]="character.diceAssignment.attack === 'D4'"
                                            (click)="onAttackDiceChange('D4')"
                                            [attr.aria-pressed]="character.diceAssignment.attack === 'D4'"
                                            aria-label="D√© D4 pour l'attaque"
                                        >
                                            <img [src]="assetsService.getDiceImage('D4')" alt="D4" class="dice-img" />
                                        </button>
                                        <button
                                            type="button"
                                            class="dice-btn"
                                            [class.selected]="character.diceAssignment.attack === 'D6'"
                                            (click)="onAttackDiceChange('D6')"
                                            [attr.aria-pressed]="character.diceAssignment.attack === 'D6'"
                                            aria-label="D√© D6 pour l'attaque"
                                        >
                                            <img [src]="assetsService.getDiceImage('D6')" alt="D6" class="dice-img" />
                                        </button>
                                    </div>
                                </div>

                                <div class="dice-card">
                                    <label>D√©fense</label>
                                    <div class="attribute-description">R√©sistance aux attaques</div>
                                    <div class="dice-buttons" role="radiogroup" aria-label="D√© de d√©fense">
                                        <button
                                            type="button"
                                            class="dice-btn"
                                            [class.selected]="character.diceAssignment.defense === 'D4'"
                                            (click)="onDefenseDiceChange('D4')"
                                            [attr.aria-pressed]="character.diceAssignment.defense === 'D4'"
                                            aria-label="D√© D4 pour la d√©fense"
                                        >
                                            <img [src]="assetsService.getDiceImage('D4')" alt="D4" class="dice-img" />
                                        </button>
                                        <button
                                            type="button"
                                            class="dice-btn"
                                            [class.selected]="character.diceAssignment.defense === 'D6'"
                                            (click)="onDefenseDiceChange('D6')"
                                            [attr.aria-pressed]="character.diceAssignment.defense === 'D6'"
                                            aria-label="D√© D6 pour la d√©fense"
                                        >
                                            <img [src]="assetsService.getDiceImage('D6')" alt="D6" class="dice-img" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div slot="footer">
        <app-ui-button (buttonClick)="generateRandomCharacter()">üé≤ G√©n√©rer al√©atoire</app-ui-button>
        <app-ui-button (buttonClick)="onSubmit()" [disabled]="!characterCreationCheckService.canCreate()">Cr√©er le personnage ‚Üí</app-ui-button>
        <app-errors-badge validationType="character-creation"></app-errors-badge>
    </div>
</app-ui-page-layout>
