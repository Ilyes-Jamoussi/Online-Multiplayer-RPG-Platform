<div class="game-map-wrapper">
    @if (tiles.length > 0) {
    <div class="map-container">
        <div class="map-grid" [ngStyle]="gridStyle">
            @for (tile of tiles; track tile.x + '-' + tile.y) {
            <app-game-map-tile [tile]="tile" [imageSrc]="getTileImage(tile.kind, tile.open)" [cssClass]="getTileClass(tile.x, tile.y)" />
            }
        </div>

        <app-game-map-tile-modal />

        <div class="objects-overlay" [ngStyle]="gridStyle">
            @for (obj of visibleObjects; track obj.id) { @if (obj.placed) {
            <div class="map-object" [ngStyle]="getObjectStyle(obj)" [class.disabled]="isPlaceableDisabled(obj.id)">
                <img [src]="getPlaceableImage(obj.kind)" [alt]="obj.kind" class="object-image" draggable="false" />
                @if (isPlaceableDisabled(obj.id)) {
                <div class="disabled-overlay">
                    <span class="disabled-icon">âœ•</span>
                    <span class="turn-count">{{ getPlaceableTurnCount(obj.id) }}</span>
                </div>
                }
            </div>
            } }
        </div>

        <div class="start-points-overlay" [ngStyle]="gridStyle">
            @for (startPoint of startPoints; track startPoint.id) {
            <div class="start-point-avatar" [ngStyle]="getStartPointStyle(startPoint)">
                <img [src]="getStartPointAvatarImage(startPoint.playerId)" [alt]="'Start point'" class="start-avatar-image" draggable="false" />
            </div>
            }
        </div>

        <div class="players-overlay" [ngStyle]="gridStyle">
            @for (player of players; track player.id) {
            <div class="map-player" [class.current-user]="isCurrentUser(player)" [ngStyle]="getPlayerStyle(player)">
                <img
                    [src]="getPlayerAvatarImage(player.id)"
                    [alt]="player.name"
                    class="player-avatar"
                    [ngStyle]="getPlayerBorderStyle(player)"
                    draggable="false"
                />
                @if (hasFlag(player)) {
                <span class="flag-indicator">ðŸš©</span>
                }
            </div>
            }
        </div>
    </div>
    } @else {
    <div class="empty">
        <p>Aucune donnÃ©e de carte disponible</p>
    </div>
    }
</div>
