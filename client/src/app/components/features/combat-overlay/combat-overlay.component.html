@if (combatData) {
    <div class="combat-overlay">
        <div class="combat-modal">
            <app-combat-timer></app-combat-timer>
            
            <div class="combat-header">
                <h2>Combat en cours</h2>
            </div>
            
            <div class="combat-arena">
                <!-- Player A -->
                <div class="fighter player-a" [class.is-me]="combatData.userRole === 'attacker'">
                    <div class="fighter-container">
                        @if (playerADamage) {
                            <div class="damage-display">
                                <span class="damage-value">-{{ playerADamage.damage }}</span>
                                <div class="dice-info">
                                    <img [src]="getDiceImageForDisplay(playerADamage.dice)" class="dice-image" />
                                    <span class="dice-roll">{{ playerADamage.roll }}</span>
                                </div>
                            </div>
                        }
                        <div class="fighter-name">{{ playerAName }}</div>
                        <div class="fighter-avatar">
                            <img [src]="playerAAvatar" [alt]="playerAName" />
                        </div>
                    </div>
                </div>

                <!-- VS -->
                <div class="vs-section">
                    <div class="vs-text">VS</div>
                    <div class="combat-swords">‚öîÔ∏è</div>
                </div>

                <!-- Player B -->
                <div class="fighter player-b" [class.is-me]="combatData.userRole === 'target'">
                    <div class="fighter-container">
                        @if (playerBDamage) {
                            <div class="damage-display">
                                <span class="damage-value">-{{ playerBDamage.damage }}</span>
                                <div class="dice-info">
                                    <img [src]="getDiceImageForDisplay(playerBDamage.dice)" class="dice-image" />
                                    <span class="dice-roll">{{ playerBDamage.roll }}</span>
                                </div>
                            </div>
                        }
                        <div class="fighter-name">{{ playerBName }}</div>
                        <div class="fighter-avatar">
                            <img [src]="playerBAvatar" [alt]="playerBName" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="combat-actions">
                <p class="stance-instruction">
                    @if (isPostureSelected) {
                        Posture s√©lectionn√©e : {{ selectedPosture === 'offensive' ? '‚öîÔ∏è Offensive' : 'üõ°Ô∏è D√©fensive' }}
                    } @else {
                        Choisissez votre posture :
                    }
                </p>
                
                <div class="action-buttons">
                    <button 
                        class="combat-btn offensive" 
                        [class.selected]="selectedPosture === 'offensive'"
                        [disabled]="isPostureSelected"
                        (click)="chooseOffensive()">
                        ‚öîÔ∏è Offensive (+2 Attaque)
                    </button>
                    <button 
                        class="combat-btn defensive" 
                        [class.selected]="selectedPosture === 'defensive'"
                        [disabled]="isPostureSelected"
                        (click)="chooseDefensive()">
                        üõ°Ô∏è D√©fensive (+2 D√©fense)
                    </button>
                </div>
            </div>
        </div>
    </div>
}
