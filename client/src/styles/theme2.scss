@use 'sass:map';
@use 'sass:color';

// ==================== TOKENS ====================
$ui-black: #0b0d10;
$ui-gray: #2a2f36;
$ui-white: #f3f4f6;
$ui-border: #1f2937;
$ui-shadow: #0f172a;

$ui-disabled-bg: #3b3f46;
$ui-disabled-fg: #a3adb8;
$ui-disabled-border: #2f3540;
$ui-disabled-shadow: #1f232b;

$ui-font-family: 'Press Start 2P', monospace;

$ui-palette: (
    primary: (
        base: #8b5cf6,
        contrast: $ui-white,
    ),
    secondary: (
        base: #f4d58d,
        contrast: $ui-black,
    ),
    tertiary: (
        base: #22d3ee,
        contrast: $ui-black,
    ),
    info: (
        base: #60a5fa,
        contrast: $ui-white,
    ),
    warn: (
        base: #f59e0b,
        contrast: $ui-black,
    ),
    danger: (
        base: #ef4444,
        contrast: $ui-white,
    ),
    error: (
        base: #dc2626,
        contrast: $ui-white,
    ),
);

$ui-gaps: (
    none: 0,
    xs: 0.25rem,
    sm: 0.5rem,
    md: 0.75rem,
    lg: 1rem,
    xl: 1.25rem,
);

$ui-font-sizes: (
    xs: 0.75rem,
    sm: 0.875rem,
    md: 1rem,
    lg: 1.125rem,
    xl: 1.25rem,
);

$ui-sizes: (
    sm: (
        padding: 0.5rem 1rem,
        font-size: map.get($ui-font-sizes, sm),
        height: 2rem,
        icon-size: 1rem,
    ),
    md: (
        padding: 0.75rem 1.25rem,
        font-size: map.get($ui-font-sizes, md),
        height: 2.5rem,
        icon-size: 1.25rem,
    ),
    lg: (
        padding: 1rem 1.75rem,
        font-size: map.get($ui-font-sizes, lg),
        height: 3rem,
        icon-size: 1.5rem,
    ),
);

$ui-font-weights: (
    light: 300,
    normal: 400,
    medium: 500,
    bold: 700,
    black: 900,
);

// capitalize lower case upper case ...
$ui-text-transforms: (
    none: none,
    capitalize: capitalize,
    lowercase: lowercase,
    uppercase: uppercase,
);

$ui-shapes: (
    square: 0,
    rounded: 0.5rem,
    pill: 9999px,
);

$ui-elevations: (
    none: none,
    xs: 2px 2px 0 $ui-shadow,
    sm: 4px 4px 0 $ui-shadow,
    md: 6px 6px 0 $ui-shadow,
    lg: 8px 8px 0 $ui-shadow,
    xl: 10px 10px 0 $ui-shadow,
);

$ui-alignments: (
    left: left,
    center: center,
    right: right,
    justify: justify,
);
$ui-transitions: (
    fast: 0.1s,
    normal: 0.2s,
    slow: 0.3s,
);
$ui-easings: (
    ease: ease,
);

// ==================== HELPERS ====================
@function ui-color($name) {
    @return map.get(map.get($ui-palette, $name), base);
}
@function ui-contrast($name) {
    @return map.get(map.get($ui-palette, $name), contrast);
}

// ==================== CORE ====================
@mixin ui-component-core {
    font-family: $ui-font-family;
    border: 2px solid $ui-border;
    position: relative;
    user-select: none;
    outline: none;
    transition:
        transform map.get($ui-transitions, fast) map.get($ui-easings, ease),
        box-shadow map.get($ui-transitions, fast) map.get($ui-easings, ease),
        filter map.get($ui-transitions, fast) map.get($ui-easings, ease);
}

// ==================== ATOMIQUES ====================
// Couleurs -> définit des variables CSS
@mixin ui-color-utilities {
    @each $name, $pair in $ui-palette {
        $base: ui-color($name);
        $contrast: ui-contrast($name);
        &.c-#{$name} {
            --ui-color: #{$base};
            --ui-contrast: #{$contrast};
            --ui-color-600: #{color.scale($base, $lightness: -12%)};
            --ui-color-700: #{color.scale($base, $lightness: -22%)};
            --ui-tint-15: #{color.mix($base, $ui-white, 15%)};
            --ui-tint-25: #{color.mix($base, $ui-white, 25%)};
            --ui-tint-85: #{color.mix($base, $ui-white, 85%)};
            --ui-shade-15: #{color.mix($base, $ui-black, 15%)};
        }
    }
}

// Styles visuels (indépendants de la couleur)
@mixin ui-style-utilities {
    &.st-filled {
        background: var(--ui-color);
        color: var(--ui-contrast);
        border-color: var(--ui-color-700);
    }
    &.st-outline {
        background: transparent;
        color: var(--ui-color);
        border-color: var(--ui-color);
    }
    &.st-ghost {
        background: transparent;
        color: var(--ui-color);
        border-color: transparent;
    }
    &.st-soft {
        background: var(--ui-tint-85);
        color: var(--ui-color-700);
        border-color: var(--ui-tint-25);
    }
    &.st-link {
        background: transparent;
        border-color: transparent;
        color: var(--ui-color);
        text-decoration: none;
        &:hover {
            text-decoration: underline;
        }
    }
}

// Taille / Forme / Align / Gap / Elevation
@mixin ui-size-variants {
    @each $name, $cfg in $ui-sizes {
        &.s-#{$name} {
            padding: map.get($cfg, padding);
            font-size: map.get($cfg, font-size);
            min-height: map.get($cfg, height);
        }
    }
}

@mixin ui-font-weight-variants {
    @each $name, $weight in $ui-font-weights {
        &.fw-#{$name} {
            font-weight: $weight;
        }
    }
}

@mixin ui-text-transform-variants {
    @each $name, $value in $ui-text-transforms {
        &.text-#{$name} {
            text-transform: $value;
        }
    }
}

@mixin ui-font-size-variants {
    @each $name, $size in $ui-font-sizes {
        &.fs-#{$name} {
            font-size: $size;
        }
    }
}

@mixin ui-shape-variants {
    @each $name, $radius in $ui-shapes {
        &.sh-#{$name} {
            border-radius: $radius;
        }
    }
}

@mixin ui-alignment-variants {
    @each $name, $alignment in $ui-alignments {
        &.al-#{$name} {
            text-align: $alignment;
            justify-content: if($alignment == left, flex-start, if($alignment == center, center, if($alignment == right, flex-end, space-between)));
        }
    }
}
@mixin ui-gap-variants($property: gap) {
    @each $name, $value in $ui-gaps {
        &.gap-#{$name} {
            #{$property}: $value;
        }
    }
}
@mixin ui-elevation-variants {
    @each $lvl, $shadow in $ui-elevations {
        &.elev-#{$lvl} {
            box-shadow: $shadow;
        }
    }
}

// Largeur (full / half / custom via --ui-w)
@mixin ui-width-variants {
    &.w-full {
        width: 100%;
    }
    &.w-half {
        width: 50%;
    }
    &.w-custom {
        width: var(--ui-w, auto);
    } // ex: 320px, 24rem, 70%
}

// États
@mixin ui-disabled-state {
    &.isDisabled {
        background: $ui-disabled-bg !important;
        color: $ui-disabled-fg !important;
        border-color: $ui-disabled-border !important;
        box-shadow: 4px 4px 0 $ui-disabled-shadow !important;
        cursor: not-allowed;
        pointer-events: none;
        * {
            color: $ui-disabled-fg !important;
            opacity: 0.6;
        }
    }
}
@mixin ui-loading-state {
    &.isLoading {
        cursor: progress;
        opacity: 0.9;
    }
}

// Interactions
@mixin ui-popout-effects {
    &:hover.popOut:not(.isDisabled):not(.isLoading):not(.disableHoverEffects) {
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 $ui-shadow;
        &:active {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 $ui-shadow;
        }
    }
}
@mixin ui-active-effects {
    &:active:not(.isDisabled):not(.isLoading):not(:hover) {
        transform: translate(1px, 1px);
        box-shadow: 1px 1px 0 $ui-shadow;
    }

    &:hover:not(.isDisabled):not(.isLoading):not(.disableHoverEffects):active {
        &:active {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 $ui-shadow;
        }
    }
}
@mixin ui-hover-brightness {
    &:hover:not(.isDisabled):not(.isLoading) {
        filter: brightness(95%);
    }
}
@mixin ui-focus-state {
    &:focus-visible {
        outline: 2px dashed $ui-black;
        outline-offset: 2px;
    }
}

// ==================== GROUPÉES ====================
@mixin ui-geometry-pack {
    @include ui-size-variants;
    @include ui-shape-variants;
    @include ui-width-variants;
}

@mixin ui-layout-pack {
    @include ui-alignment-variants;
    @include ui-gap-variants(gap);
}

@mixin ui-effects-pack {
    @include ui-elevation-variants;
    @include ui-popout-effects;
    @include ui-active-effects;
    @include ui-hover-brightness;
    @include ui-focus-state;
}

@mixin ui-states-pack {
    @include ui-disabled-state;
    @include ui-loading-state;
}

@mixin ui-visuals-pack {
    @include ui-color-utilities;
    @include ui-style-utilities;
}

@mixin ui-font-pack {
    @include ui-font-weight-variants;
    @include ui-text-transform-variants;
    @include ui-font-size-variants;
}

// ==================== FULL ====================
// À appliquer sur la racine d’un composant (.uiButton, .uiInput, .uiCard, …)
@mixin ui-full-component {
    @include ui-component-core;
    @include ui-visuals-pack;
    @include ui-geometry-pack;
    @include ui-layout-pack;
    @include ui-effects-pack;
    @include ui-states-pack;
    @include ui-font-pack;
}
